<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wu1g.dao.pano.IPanoSpotsDao">
    <!-- 字段列表 -->
    <sql id="Base_Column_List">
		 t1.id as  "id"
        ,t1.proj_id as  "projId"
        ,t1.scene_id as  "sceneId"
        ,t1.htype as  "htype"
        ,t1.title as  "title"
        ,t1.detail_info as  "detailInfo"
        ,t1.hname as  "hname"
        ,t1.ath as  "ath"
        ,t1.atv as  "atv"
        ,t1.linkedscene as  "linkedscene"
        ,t1.scale as  "scale"
        ,t1.depth as  "depth"
        ,t1.rotate as  "rotate"
        ,t1.is_onclick as  "isOnclick"
        ,t1.url as  "url"
        ,t1.version as  "version"
        ,t1.create_id as  "createId"
        ,t1.date_created as  "dateCreated"
        ,t1.date_updated as  "dateUpdated"
	</sql>

    <!-- 新增 批量数据 -->
    <insert id="insertBatch" useGeneratedKeys="true" keyProperty="id">
        insert into pano_spots(
             proj_id
            ,scene_id
            ,htype
            ,title
            ,detail_info
            ,hname
            ,ath
            ,atv
            ,linkedscene
            ,scale
            ,depth
            ,rotate
            ,url
            ,is_onclick
            ,version
            ,create_id
            ,date_created
            ,date_updated
        ) values
        <foreach collection="list" item="t" separator=",">
            (
             #{t.projId}
            ,#{t.sceneId}
            ,#{t.htype}
            ,#{t.title}
            ,#{t.detailInfo}
            ,#{t.hname}
            ,#{t.ath}
            ,#{t.atv}
            ,#{t.linkedscene}
            ,#{t.scale}
            ,#{t.depth}
            ,#{t.rotate}
            ,#{t.url}
            ,#{t.isOnclick}
            ,0
            ,#{t.createId}
            ,now()
            ,now()
            )
        </foreach>
    </insert>

    <!--信息列表 -->
    <select id="findDataIsList" parameterType="panoSpots" resultType="panoSpots">
        select
        <include refid="Base_Column_List"/>
        from pano_spots t1
        inner join pano_scene t2 on t1.scene_id=t2.id
        where t1.proj_id = #{projId}
        and scene_id=#{sceneId}
        and htype=#{htype}
        <if test="dateBegin!=null and dateBegin!=''">
            <![CDATA[ and DATE_FORMAT(t1.date_created,'%Y-%m-%d')>=DATE_FORMAT(#{dateBegin},'%Y-%m-%d')]]>
        </if>
        <if test="dateEnd!=null and dateEnd!=''">
            <![CDATA[ and DATE_FORMAT(t1.date_created,'%Y-%m-%d')<=DATE_FORMAT(#{dateEnd},'%Y-%m-%d')]]>
        </if>
        order by t1.date_created desc
    </select>
    <!-- 删除全景项目下雷达坐标 -->
    <delete id="deleteByProjId" parameterType="panoSpots">
		delete
		from pano_spots
		where  
		proj_id=#{projId}
	</delete>
    <!--删除废弃雷达坐标-->
    <delete id="deletePanoSpots" parameterType="panoSpots">
		delete
		from pano_spots
		where
		scene_id not in (select id from pano_scene)
	</delete>
</mapper>