<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wu1g.dao.org.IOrgUserDao">
    <!-- 字段列表 -->
    <sql id="Base_Column_List">
		 t1.id as  "id"
        ,t1.accid as  "accid"
        ,t1.pwd as  "pwd"
        ,t1.name as  "name"
        ,t1.job_no as  "jobNo"
        ,t1.position as  "position"
        ,t1.gender as  "gender"
        ,t1.mobile as  "mobile"
        ,t1.tel as  "tel"
        ,t1.enable as  "enable"
        ,t1.avatar as  "avatar"
        ,t1.email as  "email"
        ,t1.weixinid as  "weixinid"
        ,t1.type as  "type"
        ,t1.last_login as  "lastLogin"
        ,t1.count as  "count"
        ,t1.state as  "state"
        ,t1.skin as  "skin"
        ,t1.memo as  "memo"
        ,t1.keyword as  "keyword"
        ,t1.version as  "version"
        ,t1.order_no as  "orderNo"
        ,t1.del_flag as  "delFlag"
        ,t1.create_id as  "createId"
        ,t1.date_created as  "dateCreated"
        ,t1.date_updated as  "dateUpdated"
	</sql>
    <!-- 根据主键获取信息详情 -->
    <select id="selectByPrimaryKey" resultType="com.wu1g.vo.org.OrgUser" parameterType="com.wu1g.vo.org.OrgUser">
        select
        <include refid="Base_Column_List"/>
        from org_user t1
        where t1.id = #{id}
    </select>
    <!-- 根据主键物理删除信息 -->
    <delete id="deleteByPrimaryKey" parameterType="com.wu1g.vo.org.OrgUser">
		delete
		from org_user
		where  id = #{id}
	</delete>
    <!-- 新增单条数据 -->
    <insert id="insert" parameterType="com.wu1g.vo.org.OrgUser" useGeneratedKeys="true" keyProperty="id">
		insert into org_user (
             accid
            ,pwd
            ,name
            ,job_no
            ,position
            ,gender
            ,mobile
            ,tel
            ,enable
            ,avatar
            ,email
            ,weixinid
            ,type
            ,last_login
            ,count
            ,state
            ,skin
            ,memo
            ,keyword
            ,version
            ,order_no
            ,del_flag
            ,create_id
            ,date_created
            ,date_updated
        ) values (
             #{accid}
            ,#{pwd}
            ,#{name}
            ,#{jobNo}
            ,#{position}
            ,#{gender}
            ,#{mobile}
            ,#{tel}
            ,1
            ,#{avatar}
            ,#{email}
            ,#{weixinid}
            ,#{type}
            ,now()
            ,0
            ,#{state}
            ,#{skin}
            ,#{memo}
            ,#{keyword}
            ,0
            ,0
            ,0
            ,#{createId}
            ,now()
            ,now()
        )
	</insert>
    <!-- 数据更新 -->
    <update id="update" parameterType="com.wu1g.vo.org.OrgUser">
        update org_user set
        version=version+1,date_updated=now()
        <if test="name!= null">,name=#{name}</if>
        <if test="jobNo!= null">,job_no=#{jobNo}</if>
        <if test="position!= null">,position=#{position}</if>
        <if test="gender!= null">,gender=#{gender}</if>
        <if test="mobile!= null">,mobile=#{mobile}</if>
        <if test="tel!= null">,tel=#{tel}</if>
        <if test="enable!= null">,enable=#{enable}</if>
        <if test="avatar!= null">,avatar=#{avatar}</if>
        <if test="email!= null">,email=#{email}</if>
        <if test="weixinid!= null">,weixinid=#{weixinid}</if>
        <if test="type!= null">,type=#{type}</if>
        <if test="lastLogin!= null">,last_login=#{lastLogin}</if>
        <if test="count!= null">,count=#{count}</if>
        <if test="state!= null">,state=#{state}</if>
        <if test="skin!= null">,skin=#{skin}</if>
        <if test="memo!= null">,memo=#{memo}</if>
        <if test="keyword!= null">,keyword=#{keyword}</if>
        <if test="orderNo!= null">,order_no=#{orderNo}</if>
        where id = #{id}
    </update>
    <!-- 判断是否存在 -->
    <select id="isDataYN" parameterType="com.wu1g.vo.org.OrgUser" resultType="int">
		select count(0) from org_user where  id = #{id}
	</select>
    <!--列表通用条件-->
    <sql id="list_where_sql">
        <choose>
            <when test="delFlag!=null">
                and t1.del_flag=#{delFlag}
            </when>
            <otherwise>
                and t1.del_flag=0
            </otherwise>
        </choose>
        <if test="name!=null and name!=''">
            and t1.name like CONCAT('%',#{name},'%')
        </if>
        <if test="dateBegin!=null and dateBegin!=''">
            <![CDATA[ and DATE_FORMAT(t1.date_created,'%Y-%m-%d')>=DATE_FORMAT(#{dateBegin},'%Y-%m-%d')]]>
        </if>
        <if test="dateEnd!=null and dateEnd!=''">
            <![CDATA[ and DATE_FORMAT(t1.date_created,'%Y-%m-%d')<=DATE_FORMAT(#{dateEnd},'%Y-%m-%d')]]>
        </if>
    </sql>

    <!--信息列表 分页 -->
    <select id="findDataIsPage" parameterType="com.wu1g.vo.org.OrgUser" resultType="com.wu1g.vo.org.OrgUser">
        select
        <include refid="Base_Column_List"/>
        ,t2.roleNames
        from org_user t1
        left join (
        select GROUP_CONCAT(t1.`name`) as roleNames,t2.user_id from auth_role t1
        inner join auth_user_vs_role t2 on (t1.id=t2.role_id)
        group by t2.user_id
        ) t2 on (t1.id=t2.user_id)
        where t1.id!=1
        <include refid="list_where_sql"/>
        <if test="roleNames!=null and roleNames!=''">
            and t2.roleNames like CONCAT('%',#{roleNames},'%')
        </if>
        order by t1.enable asc,t1.date_created desc
    </select>
    <!--信息列表 -->
    <select id="findDataIsList" parameterType="com.wu1g.vo.org.OrgUser" resultType="com.wu1g.vo.org.OrgUser">
        select
        <include refid="Base_Column_List"/>
        from org_user t1
        where t1.id!=1
        <include refid="list_where_sql"/>
        order by t1.enable asc ,t1.date_created desc
    </select>
    <!--某一种角色所有用户信息列表 -->
    <select id="getUserList" parameterType="com.wu1g.vo.org.OrgUser" resultType="com.wu1g.vo.org.OrgUser">
        select
        <include refid="Base_Column_List"/>
        ,t3.name as "roleNames"
        from org_user t1
        left join auth_user_vs_role t2 on t1.id=t2.user_id
        left join auth_role t3 on t3.id = t2.role_id
        where 1=1 and t3.id=#{type} and t1.enable=#{enable}
        order by t1.date_created desc
    </select>
    <!--某一种角色所有用户信息列表(分页) -->
    <select id="getUserIsPage" parameterType="com.wu1g.vo.org.OrgUser" resultType="com.wu1g.vo.org.OrgUser">
        select
        <include refid="Base_Column_List"/>
        ,t3.name as "roleNames"
        from org_user t1
        left join auth_user_vs_role t2 on t1.id=t2.user_id
        left join auth_role t3 on t3.id = t2.role_id
        where 1=1 and t3.id=#{type} and t1.enable=#{enable}
        order by t1.date_created desc
    </select>
    <!-- 获取用户信息>根据用户登录名 -->
    <select id="findUserByLoginName" parameterType="map" resultType="com.wu1g.vo.org.OrgUser">
        select
        <include refid="Base_Column_List"/>
        from org_user t1
        where t1.del_flag=0 and enable=1
        and accid=#{accid}
        and type=#{userType}
    </select>
    <!-- 逻辑删除 -->
    <update id="deleteById" parameterType="com.wu1g.vo.org.OrgUser">
		update org_user set
		version=version+1
		,del_flag=1
		where  id = #{id}
	</update>
    <!-- 恢复逻辑删除 -->
    <update id="recoveryDataById" parameterType="com.wu1g.vo.org.OrgUser">
		update org_user set
		version=version+1
		,del_flag=0
		where  id = #{id}
	</update>
    <!-- 判断用户id是否存在 -->
    <select id="isUidYN" parameterType="java.lang.String" resultType="int">
		select count(0) from org_user where  accid=#{accid}
	</select>
</mapper>